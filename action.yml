name: 'Python Security Checker'
description: 'Pythonã‚³ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³'
branding:
  icon: 'shield'
  color: 'green'

inputs:
  target:
    description: 'ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã®Pythonãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª'
    required: true
    default: '.'
  severity:
    description: 'å•é¡Œæ¤œå‡ºã®é‡è¦åº¦é–¾å€¤ï¼ˆHIGH/MEDIUM/LOWï¼‰'
    required: false
    default: 'MEDIUM'
  html-output:
    description: 'HTMLãƒ¬ãƒãƒ¼ãƒˆã®å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª'
    required: false
    default: 'security-reports'
  fail-on-severity:
    description: 'ã“ã®é‡è¦åº¦ä»¥ä¸Šã®å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã«CIã‚’å¤±æ•—ã•ã›ã‚‹ï¼ˆHIGH/MEDIUM/LOWï¼‰'
    required: false
    default: 'HIGH'

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        cache: 'pip'
    
    - name: Install dependencies
      shell: bash
      run: |
        python -m pip install --upgrade pip
        pip install -r ${{ github.action_path }}/requirements.txt
    
    - name: Create output directory
      shell: bash
      run: mkdir -p ${{ inputs.html-output }}
    
    - name: Run security check
      shell: bash
      run: |
        if [ -f "${{ inputs.target }}" ]; then
          # å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
          python ${{ github.action_path }}/code_checker.py "${{ inputs.target }}" \
            --ci \
            --severity ${{ inputs.severity }} \
            --html ${{ inputs.html-output }}
        else
          # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆ
          find "${{ inputs.target }}" -name "*.py" \
            -not -path "*/\.*" \
            -not -path "*/venv/*" \
            -not -path "*/virtualenv/*" \
            -not -path "*/env/*" \
            -type f | while read file; do
              echo "ğŸ“ Checking: $file"
              python ${{ github.action_path }}/code_checker.py "$file" \
                --ci \
                --severity ${{ inputs.severity }} \
                --html ${{ inputs.html-output }}
          done
        fi
