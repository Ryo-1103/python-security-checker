# Python コード診断ツール

Version: 1.14

このツールは、Pythonコードの静的解析とセキュリティチェックを行う総合的な診断ツールです。コーディングスタイル、セキュリティ脆弱性、危険なコードパターン、依存関係の問題などを自動的に検出し、詳細なレポートを生成します。

## 📝 更新履歴

### 1.14 (2025-06-18)
- 🔍 以下の新しいセキュリティチェック項目を追加：
  - デシリアライゼーション攻撃対策
  - メモリ関連の脆弱性検出
  - DoS攻撃対策
  - APIセキュリティ
  - データ検証
  - ロギングとモニタリング
  - クラウドセキュリティ
  - コンテナセキュリティ
  - 依存関係の管理強化
  - セッション管理のセキュリティ

### 1.12 (2025-06-18)
- 🔄 CI/CDパイプラインの最適化
  - 自動タグ生成の改善
  - リリースプロセスの簡素化
  - バージョン管理の効率化

### 1.11 (2025-06-17)
- 🐛 バグ修正とパフォーマンス改善
- 📊 レポート出力の調整

### 1.10 (2025-06-17)
- 🔧 GitHub Actionsワークフローの改善
  - エラー処理の強化（continue-on-error対応）
  - レポート生成とアーティファクト保存の最適化
  - テスト実行の安定性向上
- 📊 HTMLレポート機能の強化
- 🛡️ セキュリティチェックの信頼性向上

## 🌟 主な機能

- ✅ コーディングスタイルチェック（PEP 8準拠）
- 🛡️ セキュリティ脆弱性の検出
- ⚠️ 危険なコードパターンの特定
- 📦 依存関係の問題チェック
- 📊 HTMLレポート出力
- 🔄 CIパイプライン統合

## 🔍 検出対象となる主な問題

### セキュリティリスク
- 危険な関数の使用（eval, exec など）
- SQLインジェクションの可能性
- 安全でないデシリアライゼーション
- ファイルシステムの危険な操作
- 脆弱な暗号化実装
- 環境変数関連の危険な操作
- 不適切なログ出力

### デシリアライゼーションとメモリ
- pickle/yaml/marshalの安全でない使用
- メモリリークの可能性
- 大きな入力データの制限
- 無限ループ・再帰の制御
- リソース枯渇対策

### APIとデータ検証
- JWTトークンの検証
- APIレートリミット
- APIバージョニング
- 入力値の型チェック
- NULLバイト攻撃対策
- バリデーション処理

### インフラストラクチャ
- クラウドサービスの認証情報
- コンテナのセキュリティ設定
- Dockerfileのベストプラクティス
- サービスアカウントの権限
- ストレージの公開設定

### DoS攻撃対策
- 無限ループの検出
- 危険な再帰呼び出し
- リソース消費の制限
- タイムアウト設定の確認
- メモリ使用量の監視
- ネットワークリソースの制御

### 機密情報
- パスワードや認証情報
- APIキーや各種トークン
- 証明書や秘密鍵情報
- データベース接続情報
- クラウド認証情報

### 依存関係とパッケージ
- 既知の脆弱性のあるパッケージ
- 古いバージョンの使用
- サプライチェーン攻撃対策
- パッケージの整合性検証

### セッションと監視
- セッションの固定化対策
- セッションタイムアウト
- セッションの並行性制御
- 機密情報のログ出力
- エラーメッセージの露出
- デバッグモードの検出

### 設定関連
- セキュリティ設定の無効化
- デバッグモードの有効化
- 危険なホスト設定
- SSL/TLS関連の設定
- タイムアウト設定

## 🚀 使用方法

### 基本的な使用方法
```bash
python code_checker.py --file target.py
```

### HTMLレポート出力
```bash
python code_checker.py --file target.py --html ./reports
```

### CIモードでの実行
```bash
python code_checker.py --file target.py --ci --severity MEDIUM
```

### すべての機能を使用
```bash
python code_checker.py --file target.py --html ./reports --ci --severity MEDIUM
```

- どの順序でも `--file` で診断対象ファイルを指定できます。

## 📋 コマンドラインオプション

| オプション | 説明 |
|------------|------|
| `file` | チェック対象のPythonファイル（必須） |
| `--html DIR` | HTMLレポートの出力ディレクトリ |
| `--ci` | CIモードで実行（終了コードで結果を返す） |
| `--severity {HIGH,MEDIUM,LOW}` | CIモードでの失敗とみなす重要度の閾値（デフォルト: MEDIUM） |

## 📊 レポート形式

### 標準出力
- コーディングスタイルの問題
- セキュリティ脆弱性
- 危険なコードパターン
- 依存関係の問題

### HTMLレポート
- 見やすい形式でのレポート表示
- 問題の重要度に応じた色分け
- 詳細な説明と行番号の表示
- レスポンシブデザイン対応

## 🔄 CIパイプライン統合

### GitHub Actionsでの使用例
```yaml
name: Code Security Check

on: [push, pull_request]

jobs:
  security-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run security check
        run: |
          python code_checker.py target.py --ci --severity MEDIUM --html ./reports
      
      - name: Upload security report
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: security-report
          path: ./reports/*.html
```

## ⚙️ 必要要件

```
pylint>=2.8.0
bandit>=1.7.0
safety>=2.0.0
```

## 📝 注意事項

- このツールは自動検出可能な問題のみを表示します
- より確実なセキュリティ評価には、手動でのコードレビューも併せて実施してください
- 誤検出の可能性もあるため、検出された問題は実際のコンテキストで判断してください

## 🔧 カスタマイズ

- 独自の危険なパターンの追加が可能
- セキュリティチェックの重要度閾値の調整
- レポート形式のカスタマイズ

## 📈 今後の予定

- [ ] より多くのセキュリティパターンの追加
- [ ] パフォーマンスの最適化
- [ ] さらなるCI/CDツールとの統合
- [ ] カスタムルールの設定ファイル対応

## 🤝 コントリビューション

バグ報告や機能要望は、Issueを作成してください。プルリクエストも歓迎です。

## 📄 ライセンス

MITライセンスの下で公開されています。

## 脆弱性データベース自動更新・新CVE通知

- NVD（米国脆弱性データベース）から最新CVE情報を自動取得し、依存パッケージと突き合わせて新たな脆弱性を検出・通知します。
- Slack通知にも対応。

### 使い方

1. NVDからCVEデータベースを取得・更新

```sh
python code_checker.py 任意のファイル.py --update-cve-db
```

2. requirements.txtの依存パッケージとCVEデータベースを突き合わせて新規脆弱性を通知

```sh
python code_checker.py 任意のファイル.py --check-cve
```

- 新たなCVEが見つかった場合は標準出力とSlack（notifier_config.json設定時）に通知されます。
- 通知済みCVEはlast_cve_notify.jsonで管理され、重複通知を防止します。

### 注意
- NVD APIの仕様上、取得件数や期間は適宜調整してください。
- requirements.txtのパッケージ名とNVDの製品名が完全一致しない場合、一部検出できないことがあります。
- Slack通知にはnotifier_config.jsonの設定が必要です。
